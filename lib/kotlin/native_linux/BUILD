# vim: ft=ruby

# https://github.com/JetBrains/kotlin/releases/latest
http_file(
  name: "dist",
  url: "https://github.com/JetBrains/kotlin/releases/download/v1.4.10/kotlin-native-linux-1.4.10.tar.gz",
  sha256: nil,
  os: :linux,
)

extract(
  name: "klib_common_stdlib",
  archive: ":dist",
  format: :tar_gz,
  paths: [
    "klib/common/stdlib/default/ir/bodies.knb",
    "klib/common/stdlib/default/ir/files.knf",
    "klib/common/stdlib/default/ir/irDeclarations.knd",
    "klib/common/stdlib/default/ir/signatures.knt",
    "klib/common/stdlib/default/ir/strings.knt",
    "klib/common/stdlib/default/ir/types.knt",
    "klib/common/stdlib/default/linkdata/module",
    "klib/common/stdlib/default/linkdata/package_kotlin.annotation/0_annotation.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/00_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/01_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/02_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/03_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/04_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/05_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/06_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/07_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/08_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/09_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/10_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/11_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/12_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/13_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/14_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/15_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/16_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/17_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/18_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/19_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/20_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/21_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/22_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/23_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/24_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.collections/25_collections.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.comparisons/0_comparisons.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.comparisons/1_comparisons.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.contracts/0_contracts.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.contracts/1_contracts.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines.cancellation/0_cancellation.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines.intrinsics/0_intrinsics.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines.intrinsics/1_intrinsics.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines.native.internal/0_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines.native.internal/1_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines.native/0_native.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines/0_coroutines.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.coroutines/1_coroutines.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.experimental/0_experimental.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.experimental/1_experimental.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.internal/0_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.internal/1_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.io/0_io.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.io/1_io.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.js/0_js.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.jvm/0_jvm.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.math/0_math.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.concurrent/0_concurrent.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.concurrent/1_concurrent.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.internal.test/0_test.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.internal.test/1_test.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.internal/0_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.internal/1_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.internal/2_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.ref/0_ref.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native.ref/1_ref.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native/0_native.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.native/1_native.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.properties/0_properties.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.random/0_random.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.random/1_random.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.ranges/0_ranges.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.ranges/1_ranges.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.ranges/2_ranges.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.reflect/0_reflect.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.reflect/1_reflect.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.sequences/0_sequences.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.sequences/1_sequences.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.sequences/2_sequences.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.system/0_system.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.test/0_test.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.test/1_test.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text.regex/0_regex.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text.regex/1_regex.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text/0_text.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text/1_text.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text/2_text.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text/3_text.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.text/4_text.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.time/0_time.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin.time/1_time.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin/0_kotlin.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin/1_kotlin.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin/2_kotlin.knm",
    "klib/common/stdlib/default/linkdata/package_kotlin/3_kotlin.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.cinterop.internal/0_internal.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.cinterop/0_cinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.cinterop/1_cinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.cinterop/2_cinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.cinterop/3_cinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.cinterop/4_cinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.wasm.jsinterop/0_jsinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.wasm.jsinterop/1_jsinterop.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx.wasm/0_wasm.knm",
    "klib/common/stdlib/default/linkdata/package_kotlinx/0_kotlinx.knm",
    "klib/common/stdlib/default/linkdata/root_package/0_.knm",
    "klib/common/stdlib/default/manifest",
    "klib/common/stdlib/default/targets/android_arm32/native/runtime.bc",
    "klib/common/stdlib/default/targets/android_arm64/native/runtime.bc",
    "klib/common/stdlib/default/targets/android_x64/native/runtime.bc",
    "klib/common/stdlib/default/targets/android_x86/native/runtime.bc",
    "klib/common/stdlib/default/targets/linux_arm32_hfp/native/runtime.bc",
    "klib/common/stdlib/default/targets/linux_arm64/native/runtime.bc",
    "klib/common/stdlib/default/targets/linux_x64/native/runtime.bc",
    "klib/common/stdlib/default/targets/wasm32/included/index.html",
    "klib/common/stdlib/default/targets/wasm32/included/jsinterop.js",
    "klib/common/stdlib/default/targets/wasm32/included/launcher.js",
    "klib/common/stdlib/default/targets/wasm32/included/math.js",
    "klib/common/stdlib/default/targets/wasm32/native/runtime.bc",
  ],
  strip_components: 1,
  os: :linux,
)

extract(
  name: "konan_lib",
  archive: ":dist",
  format: :tar_gz,
  paths: [
    "konan/lib/kotlin-native.jar",
    "konan/lib/trove4j.jar",
  ],
  strip_components: 1,
  os: :linux,
)

extract(
  name: "konan_konan_properties",
  archive: ":dist",
  format: :tar_gz,
  paths: ["konan/konan.properties"],
  strip_components: 1,
  suffix: ".orig",
  os: :linux,
)

kotlin_native_compiler(
  name: "compiler",
  classpath: ":konan_lib",
  properties: ":konan_konan_properties",
  files: [":klib_common_stdlib"],
  os: :linux,
)
