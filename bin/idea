#!/bin/bash

set -euo pipefail

WORKSPACE_ROOT=$(cd $(dirname ${BASH_SOURCE[0]}); cd ..; pwd)

export IDEA_PROPERTIES=$(mktemp -t idea.properties)
export PROJECT_ROOT=$(mktemp -d -t project)

cat <<END > $IDEA_PROPERTIES
idea.config.path=${WORKSPACE_ROOT}/etc/idea
idea.is.internal=true
idea.log.path=${WORKSPACE_ROOT}/var/log
idea.plugins.path=${WORKSPACE_ROOT}/var/tmp/src/main/kotlin/wake/idea
idea.system.path=${WORKSPACE_ROOT}/var/run/idea
wake.project.path=${WORKSPACE_ROOT}
END

open -a ${WORKSPACE_ROOT}/var/tmp/lib/idea/IntelliJ\ IDEA\ CE.app ${PROJECT_ROOT}
